language: go
sudo: true #for docker service to be enabled
os: linux


install:
  - go get github.com/karalabe/xgo
  - go get golang.org/x/mobile

script:
  - ./check-all.sh

before_deploy:
  - mkdir -p tmp && mkdir -p artifacts
  - ./gomobile_ios.sh -o tmp/Openvpn3.framework && tar -zcvf artifacts/Openvpn3.framework.tar.gz tmp/Openvpn3.framework

deploy:
  provider: releases
  file_glob: true
  file: artifacts/*
  skip_cleanup: true
  api_key: "$GIT_RELEASES_API_KEY"